<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <title>Form Pessoa + Accordion</title>

    <link rel="stylesheet" href="styles/accordion.css" />

    <!-- iziToast CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/izitoast/dist/css/iziToast.min.css">

    <!-- iziToast JS -->
    <script src="https://cdn.jsdelivr.net/npm/izitoast/dist/js/iziToast.min.js"></script>
    <script type="module" src="js/controllers/PessoaController.js"></script>
    <script type="module" src="componentes/pessoaItemListagem/pessoaItemListagem.js"></script>
</head>

<body>

    <form onsubmit="enviarForm(event)">
        <input type="text" name="nome" placeholder="Nome" required />
        <input type="number" name="idade" placeholder="Idade" required min="0" />
        <button type="submit">Enviar</button>
    </form>

    <div id="listaPessoas"></div>

    <script>

        async function enviarForm(event) {
            event.preventDefault();
            const form = event.target;

            try {
                const { pessoa, response } = await window.pessoaController.criarPessoa(Object.fromEntries(new FormData(form).entries()));

                iziToast.success({
                    title: 'Sucesso',
                    message: `${pessoa.nome}, ${pessoa.idade} anos.`,
                    position: 'topRight'
                });

                document.getElementById('listaPessoas').appendChild(await window.componenteListaPessoas.criar(pessoa));

                form.reset();

            } catch (error) {
                iziToast.error({
                    title: 'Erro',
                    message: error.message,
                    position: 'topRight'
                });
            }
        }

    </script>

</body>

</html>